<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Valorant JS - Ascent Pro</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050a14; font-family: 'Segoe UI', sans-serif; }
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px;
            border: 2px solid #00ffcc; transform: translate(-50%, -50%); pointer-events: none; z-index: 50;
        }
        #hud { position: absolute; width: 100%; height: 100%; pointer-events: none; color: white; }
        #b-market {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 400px; background: rgba(15, 25, 35, 0.98); border: 2px solid #ff4655;
            display: none; padding: 20px; z-index: 100; pointer-events: auto; color: white; box-shadow: 0 0 30px rgba(0,0,0,1);
        }
        .weapon-card { padding: 12px; background: #222; margin: 8px 0; border: 1px solid #444; cursor: pointer; display: flex; justify-content: space-between; }
        .weapon-card:hover { border-color: #00ffcc; background: #2a2a2a; }
        #bela-text {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 120px; color: #ff4655; font-weight: bold; opacity: 0; transition: 0.1s; text-shadow: 0 0 20px black;
        }
        .hp-box { position: absolute; bottom: 30px; left: 50px; border-left: 5px solid #00ffcc; padding-left: 10px; }
        #score-tab { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); font-size: 24px; font-weight: bold; letter-spacing: 2px;}
    </style>
</head>
<body>

    <div id="b-market">
        <h2 style="color: #ff4655; text-align: center; margin-top:0;">BUY PHASE</h2>
        <div class="weapon-card" onclick="buy('VANDAL', 25, 160, 40)"><span>VANDAL</span><span>2900</span></div>
        <div class="weapon-card" onclick="buy('PHANTOM', 25, 140, 35)"><span>PHANTOM</span><span>2900</span></div>
        <div class="weapon-card" onclick="buy('SHERIFF', 6, 159, 55)"><span>SHERIFF</span><span>800</span></div>
        <p style="text-align: center; color: #777; font-size: 12px;">Kapatmak için 'B'ye bas</p>
    </div>

    <div id="bela-text">BELA</div>
    <div id="score-tab">KILLS: <span id="score">0</span> / 12</div>
    <div id="crosshair"></div>
    
    <div id="hud">
        <div class="hp-box"><div style="font-size: 12px; color: #00ffcc;">HP</div><div style="font-size: 50px; font-weight: bold;" id="hp-val">100</div></div>
        <div style="position: absolute; bottom: 30px; right: 50px; text-align: right;">
            <div id="gun-name" style="color:#ff4655; font-weight:bold; letter-spacing: 2px;">PHANTOM</div>
            <div style="font-size: 60px; font-weight:bold;" id="ammo-val">25</div>
        </div>
    </div>

    <script type="importmap">
        { "imports": { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } } }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script>

    <script>
        let score = 0, ammo = 25, hp = 100, sensitivity = 0.002, killsThisRound = 0;
        let weaponStats = { head: 160, body: 40 };
        const enemies = [], objects = [];
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(f, d, v) {
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = 'square'; o.frequency.setValueAtTime(f, audioCtx.currentTime);
            g.gain.setValueAtTime(v, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination);
            o.start(); o.stop(audioCtx.currentTime + d);
        }

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x546e7a);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.rotation.order = 'YXZ'; 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        document.body.appendChild(renderer.domElement);
        scene.add(new THREE.AmbientLight(0xffffff, 0.8));

        // --- ASCENT FULL MAP ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({color: 0x555555}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        function addBox(w, h, d, x, z, col=0xcccccc) {
            const m = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshStandardMaterial({color: col}));
            m.position.set(x, h/2, z);
            scene.add(m);
            objects.push(m);
        }

        // Mid Corridor & Arch
        addBox(60, 15, 2, 0, -40, 0x999999); // Back wall
        addBox(2, 15, 80, -25, 0, 0x888888);  // Market entrance wall
        addBox(2, 15, 80, 25, 0, 0x888888);   // Pizza side wall
        addBox(12, 10, 2, 0, -20, 0x333333);  // The Arch (Kemer)
        addBox(4, 4, 4, 15, -15, 0x00ffcc);   // Radianite Crate 1
        addBox(4, 4, 4, 13, -15, 0x00ccaa);   // Radianite Crate 2
        addBox(10, 8, 10, -15, -30, 0x555555); // B-Link blocks

        // --- PRO BOT SİSTEMİ ---
        function spawnEnemy() {
            const group = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.4, 0.4), new THREE.MeshStandardMaterial({color: 0xff4655}));
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.4, 0.4), new THREE.MeshStandardMaterial({color: 0xffdbac}));
            head.position.y = 0.95;
            const gun = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.8), new THREE.MeshStandardMaterial({color: 0x111111}));
            gun.position.set(0.4, 0.2, -0.4);
            
            // Namlu Ateşi (Muzzle Flash)
            const flash = new THREE.PointLight(0xffaa00, 0, 5);
            flash.position.set(0.4, 0.2, -0.9);
            group.add(body, head, gun, flash);
            
            group.position.set((Math.random()-0.5)*35, 0.9, -30 - Math.random()*10);
            group.userData = { 
                hp: 100, 
                lastShot: Date.now(), 
                headObj: head, 
                flash,
                strafeDir: Math.random() > 0.5 ? 1 : -1,
                lastStrafe: Date.now()
            };
            scene.add(group);
            enemies.push(group);
        }
        for(let i=0; i<5; i++) spawnEnemy();

        const playerGun = new THREE.Mesh(new THREE.BoxGeometry(0.15, 0.2, 0.8), new THREE.MeshStandardMaterial({color: 0x111111}));
        playerGun.position.set(0.4, -0.3, -0.6);
        camera.add(playerGun);
        scene.add(camera);

        let isMarketOpen = false;
        document.addEventListener('keydown', (e) => {
            if(e.code === 'KeyB') {
                isMarketOpen = !isMarketOpen;
                document.getElementById('b-market').style.display = isMarketOpen ? 'block' : 'none';
                if(isMarketOpen) document.exitPointerLock(); else document.body.requestPointerLock();
            }
        });

        window.buy = (n, a, h, b) => {
            ammo = a; weaponStats.head = h; weaponStats.body = b;
            document.getElementById('gun-name').innerText = n;
            document.getElementById('ammo-val').innerText = a;
            isMarketOpen = false;
            document.getElementById('b-market').style.display = 'none';
            document.body.requestPointerLock();
        }

        document.addEventListener('mousemove', (e) => {
            if(document.pointerLockElement) {
                camera.rotation.y -= e.movementX * sensitivity;
                let tx = camera.rotation.x - e.movementY * sensitivity;
                camera.rotation.x = Math.max(-1.5, Math.min(1.5, tx));
            }
        });

        document.addEventListener('mousedown', () => {
            if(document.pointerLockElement && ammo > 0 && !isMarketOpen) {
                ammo--; document.getElementById('ammo-val').innerText = ammo;
                playSound(180, 0.1, 0.05);
                const ray = new THREE.Raycaster();
                ray.setFromCamera(new THREE.Vector2(0,0), camera);
                const hits = ray.intersectObjects(enemies, true);
                if(hits.length > 0) {
                    let hitObj = hits[0].object;
                    let bot = hitObj.parent;
                    let damage = (hitObj === bot.userData.headObj) ? weaponStats.head : weaponStats.body;
                    bot.userData.hp -= damage;
                    if(hitObj === bot.userData.headObj) playSound(900, 0.1, 0.1); 

                    if(bot.userData.hp <= 0) {
                        score++; killsThisRound++;
                        document.getElementById('score').innerText = score;
                        scene.remove(bot);
                        enemies.splice(enemies.indexOf(bot), 1);
                        spawnEnemy();
                        if(killsThisRound >= 5) {
                            const bt = document.getElementById('bela-text');
                            bt.style.opacity = "1"; playSound(100, 0.5, 0.2);
                            setTimeout(() => { bt.style.opacity = "0"; killsThisRound = 0; }, 1000);
                        }
                    }
                }
            }
        });

        const keys = {};
        document.addEventListener('keydown', (e) => keys[e.code] = true);
        document.addEventListener('keyup', (e) => keys[e.code] = false);

        function animate() {
            requestAnimationFrame(animate);
            if(document.pointerLockElement) {
                const speed = 0.15;
                if(keys['KeyW']) camera.translateZ(-speed);
                if(keys['KeyS']) camera.translateZ(speed);
                if(keys['KeyA']) camera.translateX(-speed);
                if(keys['KeyD']) camera.translateX(speed);
                camera.position.y = 1.6;

                enemies.forEach(b => {
                    b.lookAt(camera.position.x, 0.9, camera.position.z);
                    
                    // PRO STRAFE & MOVE
                    if(Date.now() - b.userData.lastStrafe > 800) {
                        b.userData.strafeDir *= -1;
                        b.userData.lastStrafe = Date.now();
                    }
                    b.translateX(0.1 * b.userData.strafeDir); // Sağa sola kaçış
                    b.translateZ(0.04); // Üstüne yürüme

                    // ATEŞ ETME VE FLASH
                    if(Date.now() - b.userData.lastShot > 1500) {
                        hp -= 10;
                        document.getElementById('hp-val').innerText = hp;
                        b.userData.flash.intensity = 5;
                        playSound(120, 0.15, 0.02);
                        setTimeout(() => b.userData.flash.intensity = 0, 50);
                        b.userData.lastShot = Date.now();
                    }
                });

                if(hp <= 0) { alert("MAÇ KAYBEDİLDİ! SKOR: " + score); location.reload(); }
                if(score >= 12) { alert("MAÇ KAZANILDI! ASSET FATİHİ."); location.reload(); }
            }
            renderer.render(scene, camera);
        }
        document.body.addEventListener('click', () => { if(!isMarketOpen) document.body.requestPointerLock(); });
        animate();
    </script>
</body>
</html>