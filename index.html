<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Valorant JS - Ascent Mid</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #0b141a; font-family: 'Segoe UI', sans-serif; }
        #crosshair {
            position: absolute; top: 50%; left: 50%; width: 10px; height: 10px;
            border: 2px solid #00ffcc; transform: translate(-50%, -50%); pointer-events: none; z-index: 20;
        }
        #hud { position: absolute; width: 100%; height: 100%; pointer-events: none; color: white; }
        .hp-bar { position: absolute; bottom: 40px; left: 60px; border-left: 5px solid #00ffcc; padding-left: 15px; }
        .ammo-box { position: absolute; bottom: 40px; right: 60px; text-align: right; }
        #neon-fx { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; transition:0.3s; z-index:5; }
        #settings { position: absolute; top:10px; left:10px; background:rgba(0,0,0,0.6); padding:10px; color:white; pointer-events:auto; }
    </style>
</head>
<body>

    <div id="neon-fx"></div>
    <div id="settings">SENS: <input type="number" id="sensInput" step="0.1" value="1.0" style="width:40px;"></div>
    <div id="crosshair"></div>
    
    <div id="hud">
        <div class="hp-bar"><div>SAĞLIK</div><div style="font-size: 40px; font-weight: bold;" id="hp-val">100</div></div>
        <div class="ammo-box">
            <div id="gun-name" style="color: #ff4655; font-weight: bold;">PHANTOM</div>
            <h1 style="font-size: 50px; margin: 0;"><span id="ammo-count">25</span></h1>
        </div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        let ammo = 25, hp = 100, isSprinting = false, sensitivity = 0.002;
        const enemies = [];
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // --- SES SİSTEMİ ---
        function playSound(freq, dur) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const g = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            g.gain.setValueAtTime(0.05, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
            osc.connect(g); g.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + dur);
        }

        // --- SAHNE VE ASCENT MID ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x384a5c);
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));

        // Ascent Mid Zemini ve Duvarları
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshPhongMaterial({color: 0x666666}));
        floor.rotation.x = -Math.PI/2;
        scene.add(floor);

        function createWall(w, h, d, x, z, color=0xcccccc) {
            const wall = new THREE.Mesh(new THREE.BoxGeometry(w, h, d), new THREE.MeshPhongMaterial({color}));
            wall.position.set(x, h/2, z);
            scene.add(wall);
        }
        createWall(40, 10, 1, 0, -20); // Mid Arka Duvar
        createWall(1, 10, 40, -15, 0); // Mid Sol Duvar
        createWall(1, 10, 40, 15, 0);  // Mid Sağ Duvar (Market tarafı)
        createWall(5, 5, 5, -5, -15, 0x00ffcc); // Radjanit Kutusu

        // --- BOTLAR (SİLAHLI) ---
        function spawnBot() {
            const botGroup = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(0.8, 1.8, 0.4), new THREE.MeshPhongMaterial({color: 0xff4655}));
            const botGun = new THREE.Mesh(new THREE.BoxGeometry(0.1, 0.1, 0.6), new THREE.MeshPhongMaterial({color: 0x000000}));
            botGun.position.set(0.4, 0.2, -0.4);
            botGroup.add(body, botGun);
            botGroup.position.set((Math.random()-0.5)*20, 0.9, -Math.random()*15 - 5);
            botGroup.userData = { lastShot: 0, dir: 1 };
            scene.add(botGroup);
            enemies.push(botGroup);
        }
        for(let i=0; i<3; i++) spawnBot();

        // --- OYUNCU SİLAHI ---
        const gun = new THREE.Mesh(new THREE.BoxGeometry(0.12, 0.18, 0.7), new THREE.MeshPhongMaterial({color: 0x111111}));
        gun.position.set(0.35, -0.25, -0.6);
        camera.add(gun);
        scene.add(camera);

        // --- HASSASİYET ---
        const sensInp = document.getElementById('sensInput');
        sensInp.addEventListener('input', () => sensitivity = 0.002 * sensInp.value);

        // --- KONTROLLER ---
        let keys = {};
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if(e.code === 'KeyE') {
                isSprinting = !isSprinting;
                document.getElementById('neon-fx').style.boxShadow = isSprinting ? "inset 0 0 80px #00ffcc" : "none";
            }
        });
        document.addEventListener('keyup', (e) => keys[e.code] = false);

        document.addEventListener('mousemove', (e) => {
            if(document.pointerLockElement) {
                camera.rotation.y -= e.movementX * sensitivity;
                let newX = camera.rotation.x - e.movementY * sensitivity;
                camera.rotation.x = Math.max(-1.4, Math.min(1.4, newX));
                camera.rotation.z = 0; // YAMUKLUK FİX
            }
        });

        document.addEventListener('mousedown', () => {
            if(document.pointerLockElement && ammo > 0) {
                ammo--;
                document.getElementById('ammo-count').innerText = ammo;
                playSound(160, 0.1);
                
                const ray = new THREE.Raycaster();
                ray.setFromCamera(new THREE.Vector2(0,0), camera);
                const hits = ray.intersectObjects(enemies, true);
                if(hits.length > 0) {
                    let b = hits[0].object.parent;
                    b.position.set((Math.random()-0.5)*20, 0.9, -Math.random()*15 - 5);
                    playSound(400, 0.05); // Hit sesi
                }
            }
        });

        function animate() {
            requestAnimationFrame(animate);
            if(document.pointerLockElement) {
                let speed = isSprinting ? 0.25 : 0.12;
                if(keys['KeyW']) camera.translateZ(-speed);
                if(keys['KeyS']) camera.translateZ(speed);
                if(keys['KeyA']) camera.translateX(-speed);
                if(keys['KeyD']) camera.translateX(speed);
                camera.position.y = 1.6;
                camera.rotation.z = 0; // HER KAREDE SIFIRLA

                enemies.forEach(bot => {
                    bot.position.x += 0.02 * bot.userData.dir;
                    if(Math.abs(bot.position.x) > 12) bot.userData.dir *= -1;
                    if(Date.now() - bot.userData.lastShot > 2500) {
                        hp -= 10;
                        document.getElementById('hp-val').innerText = hp;
                        playSound(100, 0.2); // Bot ateş sesi
                        bot.userData.lastShot = Date.now();
                    }
                });
                if(hp <= 0) { alert("Öldün!"); location.reload(); }
            }
            renderer.render(scene, camera);
        }
        document.body.addEventListener('click', () => document.body.requestPointerLock());
        animate();
    </script>
</body>
</html>